# Генератор ключей "NeoKrypton-XX"
# Многослойное кодирование с динамическими сдвигами
# ВНИМАНИЕ: Обнаружена аномалия в матрице шифрования

def main():
    # Динамическая маска, зависящая от позиции
    def dynamic_mask(pos):
        return (0x3D ^ (pos * 7)) & 0xFF

    # Дельта-смещение для каждого символа
    DELTA_TABLE = [3, 7, 11, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71]

    # Эталонные зашифрованные данные из поврежденного ядра
    ENC = [36, 87, 118, 18, 55, 95, 45, 30, 87, 116, 89, 230, 215, 211, 153, 206, 32, 55, 234, 169, 155, 95, 245, 210, 187, 228, 2, 37, 99, 51, 121, 42, 5, 122, 241]


    print("Генератор ключей NeoKrypton-XX v2.1")
    print("Обнаружена аномалия в потоке данных...")
    print("Введите аутентификационный токен для восстановления:")

    try:
        user_input = input().strip()
    except EOFError:
        print("ПРЕРВАНО: Критический сбой ввода")
        return

    if len(user_input) != len(ENC):
        print(f"ОШИБКА: Ожидалось {len(ENC)} байт, получено {len(user_input)}")
        print("АКТИВИРОВАНА ЗАЩИТА СИСТЕМЫ")
        return

    def ror2(x):
        """Поворот вправо на 2 бита (Rotate Right)"""
        return ((x >> 2) | (x << 6)) & 0xFF

    def swap_nibbles(x):
        """Обмен старшего и младшего полубайтов"""
        return ((x & 0x0F) << 4) | ((x & 0xF0) >> 4)

    # Применяем многослойное кодирование NeoKrypton
    encrypted_input = []
    for i, char in enumerate(user_input):
        char_code = ord(char)

        # Этап 1: Динамическое смещение из таблицы
        delta = DELTA_TABLE[i % len(DELTA_TABLE)]
        a = (char_code + delta) & 0xFF

        # Этап 2: Обмен полубайтов
        b = swap_nibbles(a)

        # Этап 3: Циклический сдвиг вправо
        c = ror2(b)

        # Этап 4: XOR с динамической маской
        final = c ^ dynamic_mask(i)

        encrypted_input.append(final)

    # Проверка целостности данных
    if encrypted_input == ENC:
        print("=" * 50)
        print("ДОСТУП РАЗРЕШЕН: Уровень доступа OMEGA")
        print("Аномалия устранена. Система стабилизирована.")
        print("NeoKrypton-XX: Матрица восстановлена")
        print("=" * 50)
    else:
        print("ОШИБКА: Недействительный токен!")
        print("ИНИЦИИРОВАНА ПОСЛЕДОВАТЕЛЬНОСТЬ БЛОКИРОВКИ")
        print("Обратитесь к администратору системы")


if __name__ == "__main__":
    main()